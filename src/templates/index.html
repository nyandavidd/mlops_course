<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Предсказание цены квартиры</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=484800da-591a-4991-8a20-010f910fe8e4&lang=ru_RU"
     type="text/javascript"></script>
    <script src="https://yastatic.net/s3/mapsapi-jslibs/heatmap/0.0.1/heatmap.min.js" 
    type="text/javascript"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="container">
        <h1 class="text-center mb-4">Предсказание цены квартиры</h1>
        <div class="row">
            <div class="col-md-6">
                <form method="post" onsubmit="return validateForm()" class="compact-form">
                    {% if error %}
                    <div class="alert alert-danger py-2 px-3" role="alert">
                        {{ error }}
                    </div>
                    {% endif %}
                    
                    <div class="year-slider-container">
                        <label for="year" class="form-label">Год продажи:</label>
                        <div class="form-group">
                            <input type="range" class="year-slider" id="year" name="year" 
                                   min="2018" max="2025" step="1" value="2018"
                                   oninput="updateYearValue(this.value)">
                            <div class="year-slider-labels">
                                <div class="year-slider-label">2018</div>
                                <div class="year-slider-label">2019</div>
                                <div class="year-slider-label">2020</div>
                                <div class="year-slider-label">2021</div>
                                <div class="year-slider-label">2022</div>
                                <div class="year-slider-label">2023</div>
                                <div class="year-slider-label">2024</div>
                                <div class="year-slider-label">2025</div>
                            </div>
                            <div class="year-value" id="yearValue">2018</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="month" class="form-label">Месяц продажи:</label>
                        <select class="form-select" id="month" name="month" required>
                            <option value="1">Январь</option>
                            <option value="2">Февраль</option>
                            <option value="3">Март</option>
                            <option value="4">Апрель</option>
                            <option value="5">Май</option>
                            <option value="6">Июнь</option>
                            <option value="7">Июль</option>
                            <option value="8">Август</option>
                            <option value="9">Сентябрь</option>
                            <option value="10">Октябрь</option>
                            <option value="11">Ноябрь</option>
                            <option value="12">Декабрь</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="building_type" class="form-label">Тип дома:</label>
                        <select class="form-select" id="building_type" name="building_type" required>
                            <option value="1" {% if request.form.get('building_type')=='1' %}selected{% endif %}>Панельный</option>
                            <option value="2" {% if request.form.get('building_type')=='2' %}selected{% endif %}>Монолитный</option>
                            <option value="3" {% if request.form.get('building_type')=='3' %}selected{% endif %}>Кирпичный</option>
                            <option value="4" {% if request.form.get('building_type')=='4' %}selected{% endif %}>Блочный</option>
                            <option value="5" {% if request.form.get('building_type')=='5' %}selected{% endif %}>Деревянный</option>
                            <option value="0" {% if request.form.get('building_type')=='0' %}selected{% endif %}>Другой</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="object_type" class="form-label">Тип квартиры:</label>
                        <select class="form-select" id="object_type" name="object_type" required>
                            <option value="1" {% if request.form.get('object_type')=='1' %}selected{% endif %}>Вторичное жильё</option>
                            <option value="11" {% if request.form.get('object_type')=='11' %}selected{% endif %}>Новостройка</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="rooms" class="form-label">Количество комнат:</label>
                        <select class="form-select" id="rooms" name="rooms" required>
                            <option value="-1" {% if request.form.get('rooms')=='-1' %}selected{% endif %}>Студия</option>
                            <option value="1" {% if request.form.get('rooms')=='1' %}selected{% endif %}>1</option>
                            <option value="2" {% if request.form.get('rooms')=='2' %}selected{% endif %}>2</option>
                            <option value="3" {% if request.form.get('rooms')=='3' %}selected{% endif %}>3</option>
                            <option value="4" {% if request.form.get('rooms')=='4' %}selected{% endif %}>4</option>
                            <option value="5" {% if request.form.get('rooms')=='5' %}selected{% endif %}>5</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="levels" class="form-label">Количество этажей в доме:</label>
                        <input type="number" class="form-control" id="levels" name="levels" min="1" value="{{ request.form.get('levels', '') }}" required>
                    </div>

                    <div class="form-group">
                        <label for="floor" class="form-label">Этаж квартиры:</label>
                        <input type="number" class="form-control" id="floor" name="floor" min="1" value="{{ request.form.get('floor', '') }}" required>
                    </div>

                    <div class="form-group">
                        <label for="area" class="form-label">Общая площадь квартиры:</label>
                        <input type="number" class="form-control" id="area" name="area" step="0.1" min="0" value="{{ request.form.get('area', '') }}" required>
                    </div>

                    <div class="form-group">
                        <label for="kitchen_area" class="form-label">Площадь кухни:</label>
                        <input type="number" class="form-control" id="kitchen_area" name="kitchen_area" step="0.1" min="0" value="{{ request.form.get('kitchen_area', '') }}" required>
                    </div>

                    <input type="hidden" name="geo_lat" id="geo_lat" value="{{ request.form.get('geo_lat', '') }}">
                    <input type="hidden" name="geo_lon" id="geo_lon" value="{{ request.form.get('geo_lon', '') }}">
                    
                    <div class="submit-container">
                        <button type="button" id="predictButton" class="btn btn-primary">Предсказать цену</button>
                    </div>
                </form>
            </div>
            <div class="col-md-6">
                <div id="map" data-heatmap-points='{{ heatmap_points|tojson|safe }}'></div>
                <div id="predictionResult"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>